version: '3.7'
services:
 mysql:
  container_name: ${NAME}_mysql
  image: mysql:8.0.13
  restart: on-failure
  command: ["--default-authentication-plugin=mysql_native_password"]
  volumes:
   - "./.data/mysql:/var/lib/mysql"
  environment:
   MYSQL_DATABASE: ${MYSQL_DATABASE}
   MYSQL_USER: ${MYSQL_DATABASE_USER}
   MYSQL_PASSWORD: ${MYSQL_PASSWORD}
   MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
  networks:
   default:
    ipv4_address: ${MYSQL_IP}

 php:
  container_name: ${NAME}_php
  build:
   context: ./etc/php
  volumes:
   - "./project/:/srv/src/project:cached"
   - "./etc/php/config/xdebug.ini:/usr/local/etc/php/conf.d/xdebug.ini"
  networks:
   default:
    ipv4_address: ${PHP_IP}
  environment:
   PHP_IDE_CONFIG: "serverName=healthy-food.loc"
  extra_hosts:
   - "host.docker.internal:host-gateway"

 nginx:
  container_name: ${NAME}_nginx
  image: nginx:1.15.8
  volumes:
   - "./.data/nginx/logs:/var/log/nginx"
   - "./etc/nginx/project.conf:/etc/nginx/conf.d/default.conf"
   - "./project/:/srv/src/project:cached"
  networks:
   default:
    ipv4_address: ${NGINX_IP}

 redis:
  container_name: ${NAME}_redis
  image: redis:alpine
  volumes:
   - "./.data/redis:/data"
   - "./docker/redis/redis.conf:/usr/local/etc/redis/redis.conf"
  command: [ "redis-server", "/usr/local/etc/redis/redis.conf", "--requirepass", "${REDIS_PASSWORD}", "--loglevel", "${REDIS_LOGLEVEL:-notice}", "--save", "900", "1", "--save", "300", "10", "--save", "60", "10000" ]
  networks:
   default:
    ipv4_address: ${REDIS_IP}
  depends_on:
   - mysql

 pra:
  container_name: ${NAME}_pra
  image: erikdubbelboer/phpredisadmin
  environment:
   - ADMIN_USER=${REDIS_USER}
   - ADMIN_PASS=${REDIS_USER_PASSWORD}
   - REDIS_1_HOST=${NAME}_redis
   - REDIS_1_PORT=6379
   - REDIS_1_AUTH=${REDIS_PASSWORD}
  depends_on:
   - redis
  networks:
   default:
    ipv4_address: ${PRA_IP}

networks:
 default:
  driver: bridge
  ipam:
   driver: default
   config:
    - subnet: ${SUBNET}

